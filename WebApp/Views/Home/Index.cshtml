@model WebApp.Models.ViewModels.HomeVM

<div class="container">
    <div class="text-center">
        <button class="btn btn-dark filter-button" data-filter="all">All</button>
        @foreach (var obj in Model.Categories)
        {
            <button class="btn btn-outline-secondary filter-button" data-filter="@obj.Name.Replace(' ', '_')">@obj.Name</button>
        }

    </div>

    
    <div class="search-section mx-auto mt-4 p-3">
        <div class="row g-3">
            <div class="col-md-3">
                <input type="text" class="form-control" id="price-filter" placeholder="Price" />
            </div>
            <div class="col-md-4 position-relative">
                <input type="text" class="form-control city-filter" id="city-filter" placeholder="City" />
                <i class="fa-solid fa-location-dot position-absolute" style="top: 50%; left: 10px; transform: translateY(-50%); font-size: 18px;"></i>
            </div>
            <div class="col-md-3">
                <select class="form-control" id="type-filter">
                    <option value="">Select Type</option>
                    @foreach (var type in Model.ListingsType)
                    {
                        <option value="@type.Name">@type.Name</option>
                    }
                </select>
            </div>
            <div class="col-md-2">
                <button class="btn btn-primary w-100" id="apply-filters">Apply</button>
            </div>
        </div>
    </div>


    <br />
    <div class="row" id="product-container">
        @foreach (var obj in Model.Products)
        {
            <partial name="_IndividualItem" model="obj" />
        }
    </div>
    <div class="text-center">
        <button id="load-more" data-current-page="@Model.CurrentPage" data-total-pages="@Model.TotalPages">
            <i class="fa-solid fa-arrow-rotate-right"></i> Load More
        </button>
    </div>



    <div class="text-center">
        <nav aria-label="Page navigation">
            <ul class="pagination justify-content-center" id="pagination-container">
                @for (int i = 1; i <= Model.TotalPages; i++)
                {
                    <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                        <a class="page-link" href="@Url.Action("Index", new { page = i })">@i</a>
                    </li>
                }
            </ul>
        </nav>
    </div>
</div>






@section Scripts {
    <script>
        $(document).ready(function () {
            $(".filter-button").click(function () {
                var value = $(this).attr('data-filter');
                if (value == "all") {
                    $('.filter').show('1000');
                } else {
                    $(".filter").not('.' + value).hide('3000');
                    $('.filter').filter('.' + value).show('3000');
                }
            });
        });
    </script>



    <script>
        $(document).ready(function () {
            $("#load-more").click(function () {
                var button = $(this);
                var currentPage = parseInt(button.data('current-page'));
                var totalPages = parseInt(button.data('total-pages'));

                if (currentPage < totalPages) {
                    $.ajax({
                        url: '@Url.Action("Index", "Home")',
                        type: 'GET',
                        data: {
                            page: currentPage + 1
                        },
                        success: function (data) {
                            var newProducts = $(data).find("#product-container").html();
                            var newPagination = $(data).find("#pagination-container").html();

                            
                            if (newProducts.trim().length === 0) {
                                button.hide(); 
                            } else {
                                $("#product-container").append(newProducts);
                                $("#pagination-container").html(newPagination);
                                button.data('current-page', currentPage + 1);
                            }
                        },
                        error: function () {
                            alert('Wystąpił błąd podczas ładowania danych.');
                        }
                    });
                } else {
                    button.hide(); 
                }
            });
        });
    </script>
}


<style>
    #load-more {
        background-color: #ffffff; 
        color: #000000;
        border: 2px solid #000000; 
        padding: 5px 10px; 
        border-radius: 0.25rem; 
        display: inline-flex; 
        align-items: center; 
        margin:20px;
    }

        #load-more i {
            margin-right: 8px; 
        }

        #load-more:hover {
            background-color: #f8f9fa; 
            color: #000000; 
            border-color: #000000; 
        }



    .pagination {
        display: flex;
        justify-content: center;
        padding: 0;
        margin: 0;
        list-style: none;
    }

        .pagination .page-item {
            margin: 0 2px;
        }

        .pagination .page-link {
            display: block;
            padding: 8px 16px;
            color: #343a40;
            background-color: #ffffff;
            border: 1px solid #343a40;
            border-radius: 0.25rem;
            text-decoration: none;
        }

            .pagination .page-link:hover {
                background-color: #f8f9fa; 
            }

        .pagination .page-item.active .page-link {
            background-color: #343a40; 
            color: #ffffff; 
        }



    .search-section {
        background-color: white; 
        border-radius: 0.25rem;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); 
        max-width: 600px;
    }

    .position-relative {
        position: relative;
    }
   
    .city-filter {
        padding-left: 2.5rem; 
    }

        .city-filter::placeholder {
            padding-left: 2.5rem; 
        }
</style>
